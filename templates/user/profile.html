{% extends "base_lp.html" %}
{% load sys_template %}
{% load static %}
{% block content %}      
<!-- Page header starts -->
<div class="container-fluid">
    <div class="page-header-wrap overflow-hidden parent-floating pt-20">
        <div class="profile-header floating" style="background-image: url({%if user.profile.header_img%}{{user.profile.header_img.url}}{%else%}{%static 'images/hero-car.png'%}{%endif%})"></div>
    </div>
</div>

<!-- page starts -->
<div class="container page-container booster-page">
    <div class="user-info d-flex flex-column align-items-center">
        <img src="{%if user.profile.owner_name%}{{user.avatar.url}}{%else%}{%static 'images/man.png'%}{%endif%}" alt="" class="profile-img rounded-circle">
        <div class="user-name">
            <h2>{%if user.profile.owner_name%}{{user.profile.owner_name}}{%else%}未登録{%endif%}</h2>
        </div>
        <div class="user-link">
            <a href="https://www.shokubun.co.jp/">{%if user.profile.contact_form%}{{user.profile.contact_form}}{%else%}未登録{%endif%}</a>
        </div>
        
        <div class="user-socials pt-2">
            {% if twitter_user %}
            <ul class="lists">                
                <li class="list-item">
                    <a href="#" class="list-link">
                        <img src="{%static 'images/twitter1.png'%}" alt="" class="list-fig rounded-circle">
                    </a>
                </li>
            </ul>
            {%endif%}
        </div>
        
        <div class="user-status d-flex justify-content-between align-items-center">
            <div class="number d-flex flex-column align-items-center justify-content-center">
                <div class="total fs-20 fw-bold">{{campaign_num}}</div>
                <div class="label fs-12 mt-2">キャンペーン数</div>
            </div>
            <div class="divider"></div>
            <div class="number d-flex flex-column align-items-center justify-content-center">
                <div class="total fs-20 fw-bold">{{applicant_num}}</div>
                <div class="label fs-12 mt-2">当選者数</div>
            </div>
        </div>
    </div>
    <div class="tap-bar d-flex align-items-center justify-content-center">
        <a href="#" class="tab active open">開催中</a>
        <a href="#" class="tab closed">終了</a>
    </div>
    <div class="campaigns d-grid gc-2 gap-4 ptb-6">
        
    </div>
</div>

{% endblock content %}
{% block scripts %}
<script type="text/javascript" src="{% static 'js/vendor.min.js' %}"></script>    
<script type="text/javascript" src="{% static 'js/pages/jquery.todo.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
<script type="text/javascript" src="{% static 'js/custom.js' %}"></script>
<script type="text/javascript">
    const campaigns = document.querySelector('.campaigns');
    const tabBtns = document.querySelectorAll('.tap-bar .tab');
    const data = [];
    {%for campaign in publish_campaigns %}
        one_data = {
            id: '{{campaign.id}}',
            img: "{% with campaign|get_creative_img as img %}{%if img%}{{img.url}}{%endif%}{%endwith%}",
            badge: "公開中",
            everyone: '{{campaign|get_applicant_by_campaign}}',
            myself: 0,
            status: "open"
        };
        data.push(one_data);
    {%endfor%}
    {%for campaign in end_campaigns %}
        one_data = {
            id: '{{campaign.id}}',
            img: "{% with campaign|get_creative_img as img %}{%if img%}{{img.url}}{%endif%}{%endwith%}",
            badge: "終了",
            everyone: 0,
            myself: 0,
            status: "closed"
        };
        data.push(one_data);
    {%endfor%}
    console.log(data);
    let html ="";

    let status = "open";

    tabBtns.forEach( btn => {

        btn.addEventListener( "click", function(e){
            e.preventDefault();
            
            tabBtns.forEach( btn => btn.classList.remove('active') );

            if( this.classList.contains('open') ){
                status = "open";
                this.classList.add('active');
                html = '';
                addData();
            }
            if( this.classList.contains("closed") ){
                status = "closed";
                this.classList.add('active');
                html = '';
                addData();
            }

        } )

    } )

    function addData(){
        data.forEach( item => {
            if( item.status === status ){
                html += `<div class="campaign text-center">
                                <a href="/campaign/${item.id}" class="campaign-item">
                                    <img src="${item.img}" class="campaign-img">
                                    <div class="campaign-status-badge-wrapper">
                                        <div class="campaign-status-badge closed">${item.badge}</div>
                                    </div>
                                    <div class="item-body">
                                        <div class="item-footer p-16">
                                            <div class="campaign-number-status d-flex align-items-center justify-content-between">
                                                    <div class="number-col">
                                                        <div class="number ">
                                                            <div class="fs-16 fw-bold">${item.myself}</div>
                                                            <div class="label fs-12">自分</div>
                                                        </div>
                                                    </div>
                                                    <div class="divider"></div>                           
                                                    <div class="number-col">
                                                        <div class="number">
                                                            <div class="fs-16 fw-bold">${item.everyone}</div>
                                                            <div class="label fs-12">みんな</div>
                                                        </div>
                                                    </div>
                                                    <div class="divider"></div>
                                                    <div class="number-col">
                                                    <div class="number">
                                                        <div class="end">終了</div>                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>`;
            }
        } )
        
        campaigns.innerHTML = html;
    }

    window.addEventListener( "load", addData );
</script>
{% endblock %}
